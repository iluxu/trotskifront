<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trotski - License Ready</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap');

    :root {
      --bg: #0b0b12;
      --panel: #12131c;
      --ink: #f4f4f8;
      --muted: #9aa3b2;
      --acid: #a6ff00;
      --hot: #ff3d7f;
      --line: rgba(255, 255, 255, 0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      color: var(--ink);
      background: linear-gradient(180deg, #0b0b12 0%, #0d0f19 100%);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .card {
      width: min(520px, 92vw);
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 28px;
    }

    h1 { font-size: 2rem; margin-bottom: 10px; }
    p { color: var(--muted); line-height: 1.5; }

    .license {
      margin: 22px 0 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.3rem;
      letter-spacing: 0.08em;
      padding: 16px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    button, a {
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }

    button { background: linear-gradient(135deg, var(--acid), var(--hot)); color: #0b0b12; }
    a { border: 1px solid var(--line); color: var(--ink); }
  </style>
</head>
<body>
  <div class="card">
    <h1>License ready</h1>
    <p id="status">Verifying your checkout session...</p>
    <div class="license" id="license">----</div>
    <div class="actions">
      <button id="copyButton">Copy license</button>
      <a href="/app">Open app</a>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get('session_id');
    const statusEl = document.getElementById('status');
    const licenseEl = document.getElementById('license');
    const copyButton = document.getElementById('copyButton');

    async function loadLicense() {
      if (!sessionId) {
        statusEl.textContent = 'Missing session id.';
        return;
      }

      try {
        const res = await fetch(`/api/success?session_id=${encodeURIComponent(sessionId)}`);
        const data = await res.json();
        if (!res.ok || !data.license) throw new Error(data.error || 'License unavailable');
        licenseEl.textContent = data.license;
        statusEl.textContent = 'Saved. Use this key in the app.';
      } catch (err) {
        statusEl.textContent = 'Could not verify session. Contact support.';
      }
    }

    copyButton.addEventListener('click', async () => {
      const text = licenseEl.textContent.trim();
      if (!text || text === '----') return;
      await navigator.clipboard.writeText(text);
      copyButton.textContent = 'Copied';
      setTimeout(() => { copyButton.textContent = 'Copy license'; }, 1400);
    });

    loadLicense();
  </script>
</body>
</html>
